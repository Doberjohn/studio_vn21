generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

enum UserRole {
  ADMIN
  EDITOR
  VIEWER
}

model Story {
  id                String   @id @default(cuid())
  title             String
  author            String
  description       String   @db.Text
  content           String   @db.Text
  coverImage        String
  desktopCoverImage String?
  featuredCoverImage String?
  publishDate       DateTime
  featured          Boolean  @default(false)
  isVisible         Boolean  @default(true)
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  genres      StoryGenre[]
  collections StoryCollection[]

  @@index([featured])
  @@index([publishDate])
  @@index([isVisible])
}

model Genre {
  id        String @id @default(cuid())
  name      String @unique
  isVisible Boolean @default(true)
  stories   StoryGenre[]

  @@index([isVisible])
}

model Collection {
  id        String @id @default(cuid())
  name      String @unique
  isVisible Boolean @default(true)
  stories   StoryCollection[]

  @@index([isVisible])
}

model StoryGenre {
  storyId String
  genreId String
  story   Story @relation(fields: [storyId], references: [id], onDelete: Cascade)
  genre   Genre @relation(fields: [genreId], references: [id], onDelete: Cascade)

  @@id([storyId, genreId])
}

model StoryCollection {
  storyId      String
  collectionId String
  story        Story      @relation(fields: [storyId], references: [id], onDelete: Cascade)
  collection   Collection @relation(fields: [collectionId], references: [id], onDelete: Cascade)

  @@id([storyId, collectionId])
}

model User {
  id         String   @id @default(cuid())
  authUserId String   @unique
  email      String   @unique
  role       UserRole @default(VIEWER)
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  @@index([authUserId])
  @@index([email])
  @@index([role])
}
