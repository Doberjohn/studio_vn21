generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

model Story {
  id                String   @id @default(cuid())
  title             String
  author            String
  description       String   @db.Text
  content           String   @db.Text
  coverImage        String
  desktopCoverImage String?
  featuredCoverImage String?
  publishDate       DateTime
  featured          Boolean  @default(false)
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  genres      StoryGenre[]
  collections StoryCollection[]

  @@index([featured])
  @@index([publishDate])
}

model Genre {
  id    String @id @default(cuid())
  name  String @unique
  stories StoryGenre[]
}

model Collection {
  id    String @id @default(cuid())
  name  String @unique
  stories StoryCollection[]
}

model StoryGenre {
  storyId String
  genreId String
  story   Story @relation(fields: [storyId], references: [id], onDelete: Cascade)
  genre   Genre @relation(fields: [genreId], references: [id], onDelete: Cascade)

  @@id([storyId, genreId])
}

model StoryCollection {
  storyId      String
  collectionId String
  story        Story      @relation(fields: [storyId], references: [id], onDelete: Cascade)
  collection   Collection @relation(fields: [collectionId], references: [id], onDelete: Cascade)

  @@id([storyId, collectionId])
}
